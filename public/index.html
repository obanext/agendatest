async function fetchAgenda() {
  const when = getQueryParam("when") || "b_thisweek";
  const where = getQueryParam("where") || "";
  const screen = parseInt(getQueryParam("screen") || "1");

  const res = await fetch(
    `/api/agenda?when=${encodeURIComponent(when)}&where=${encodeURIComponent(where)}&screen=${screen}`
  );

  const data = await res.json();
  const { items, totalScreens } = data;

  document.querySelector(".text-black").textContent = `${screen}/${totalScreens}`;

  const container = document.getElementById("agenda");
  container.innerHTML = "";

  items.forEach((event, i) => {
    const date = new Date(event.startRaw);
    const dag = date.toLocaleDateString("nl-NL", { weekday: "long" });
    const dagNum = String(date.getDate()).padStart(2, "0");
    const maand = date.toLocaleDateString("nl-NL", { month: "short" }).toLowerCase();
    const tijd = date
      .toLocaleTimeString("nl-NL", { hour: "2-digit", minute: "2-digit" })
      .replace(":", ".");

    const row = document.createElement("div");
    row.className =
      "grid grid-cols-[140px_70px_1fr_90px] items-center px-10 gap-6";

    row.innerHTML = `
      <div class="text-[26px] lowercase">${dag}</div>

      <div class="bg-black text-white font-black text-center w-16 h-16 flex flex-col justify-center leading-none">
        <div class="text-[26px]">${dagNum}</div>
        <div class="text-[14px] uppercase">${maand}</div>
      </div>

      <div class="flex flex-col overflow-hidden">
        <div class="text-[28px] font-black leading-tight line-clamp-1">${event.title}</div>
        <div class="text-[#e7a024] text-[18px]" style="font-family:AvenirLight;">${event.locatie}</div>
      </div>

      <div class="text-[26px] font-black text-right">${tijd}</div>
    `;

    container.appendChild(row);
  });
}
